<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca - ET N¬∞35</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #d62b16 0%, #D68C16 100%);
            min-height: 100vh;
        }

        /* ============================================
           P√ÅGINA DE LOGIN/REGISTRO
        ============================================ */
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        #loginPage.hidden {
            display: none;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 50px;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo-h1 {
            display: flex;
            align-items: center; /* centra verticalmente */
            justify-content: center;
            gap: 10px;
        }

        #login-logo {
            width: 10%;
        }

        .login-header h1 {
            color: #d62b16;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #718096;
            font-size: 1.1em;
        }

        .form-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #718096;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-tab.active {
            color: #da4734;
            border-bottom-color: #da4734;
        }

        .form-content {
            display: none;
        }

        .form-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #D62B16 0%, #D68C16 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        /* ============================================
           P√ÅGINA DEL SISTEMA (DASHBOARD)
        ============================================ */
        #systemPage {
            display: none;
            min-height: 100vh;
            background: #f7fafc;
        }

        #systemPage.active {
            display: block;
        }

        /* SIDEBAR DE NAVEGACI√ìN */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 30px 0;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 30px 30px;
            border-bottom: 2px solid #e2e8f0;
        }

        .sidebar-brand {
            font-size: 1.8em;   
            color: #D62B16;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-user {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #D62B16 0%, #D68C16 100%);
            border-radius: 10px;
            color: white;
        }

        .sidebar-user-name {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .sidebar-user-role {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 30px;
            color: #4a5568;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.05em;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: #f7fafc;
            color: #EB5642;
            border-left-color: #D62B16;
        }

        .nav-item.active {
            background: #edf2f7;
            color: #D62B16;
            border-left-color: #D62B16;
        }

        .nav-icon {
            font-size: 1.3em;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            padding: 0 30px;
        }

        .btn-logout {
            width: 100%;
            padding: 12px;
            background: #D68C16;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: #BD2814;
            transform: translateY(-2px);
        }

        /* CONTENIDO PRINCIPAL */
        .main-content {
            margin-left: 280px;
            padding: 40px;
            min-height: 100vh;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2em;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #718096;
            font-size: 1.1em;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease-in;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .card-title {
            font-size: 1.5em;
            color: #2d3748;
            font-weight: 600;
        }

        .btn-add {
            padding: 12px 25px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f7fafc;
        }

        th {
            padding: 15px;
            text-align: left;
            color: #4a5568;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            color: #2d3748;
        }

        tbody tr:hover {
            background: #f7fafc;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-available {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-borrowed {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-reserved {
            background: #feebc8;
            color: #7c2d12;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background: #bee3f8;
            color: #2c5282;
        }

        .btn-edit:hover {
            background: #90cdf4;
        }

        .btn-delete {
            background: #fed7d7;
            color: #742a2a;
        }

        .btn-delete:hover {
            background: #fc8181;
        }

        .btn-borrow {
            background: #9ae6b4;
            color: #22543d;
        }

        .btn-borrow:hover {
            background: #68d391;
        }

        .btn-reserve {
            background: #fbd38d;
            color: #7c2d12;
        }

        .btn-reserve:hover {
            background: #f6ad55;
        }

        .btn-download {
            background: #b794f4;
            color: #44337a;
        }

        .btn-download:hover {
            background: #9f7aea;
        }

        /* ESTAD√çSTICAS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #D62B16 0%, #D68C16 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* GRID DE RECURSOS */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .resource-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .resource-title {
            font-size: 1.2em;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .resource-meta {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .resource-description {
            color: #4a5568;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.8em;
            color: #2d3748;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #718096;
            line-height: 1;
        }

        .btn-close:hover {
            color: #2d3748;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .resources-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ============================================
         P√ÅGINA DE LOGIN/REGISTRO
    ============================================ -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo-h1">
                    <img src="../recursos/logo_justo.png" id="login-logo" alt="Logo - Bibloteca 'La 35'" />
                    <h1>Biblioteca N¬∞35</h1>
                </div>
                <p>Sistema de Gesti√≥n Bibliotecaria</p>
            </div>

            <div class="form-tabs">
                <button class="form-tab active" onclick="switchFormTab('login')">Iniciar Sesi√≥n</button>
                <button class="form-tab" onclick="switchFormTab('register')">Registrarse</button>
            </div>

            <!-- LOGIN FORM -->
            <div id="loginForm" class="form-content active">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Tipo de Usuario</label>
                        <select id="loginUserType" required>
                            <option value="">Seleccione un tipo</option>
                            <option value="bibliotecaria">Bibliotecaria</option>
                            <option value="profesor">Profesor</option>
                            <option value="estudiante">Estudiante</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Usuario</label>
                        <input type="text" id="loginUsername" placeholder="Ingrese su usuario" required>
                    </div>
                    <div class="form-group">
                        <label>Contrase√±a</label>
                        <input type="password" id="loginPassword" placeholder="Ingrese su contrase√±a" required>
                    </div>
                    <button type="submit" class="btn">Iniciar Sesi√≥n</button>
                </form>
            </div>

            <!-- REGISTER FORM -->
            <div id="registerForm" class="form-content">
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Tipo de Usuario</label>
                        <select id="registerUserType" required onchange="toggleCursoField()">
                            <option value="">Seleccione un tipo</option>
                            <option value="bibliotecaria">Bibliotecaria</option>
                            <option value="profesor">Profesor</option>
                            <option value="estudiante">Estudiante</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" id="registerName" placeholder="Ingrese su nombre completo" required>
                    </div>
                    <div class="form-group">
                        <label>DNI</label>
                        <input type="text" id="registerDNI" placeholder="Ingrese su DNI" required>
                    </div>
                    <div class="form-group" id="cursoGroup" style="display: none;">
                        <label>Curso</label>
                        <input type="text" id="registerCurso" placeholder="Ej: 5¬∞ A">
                    </div>
                    <div class="form-group">
                        <label>Usuario</label>
                        <input type="text" id="registerUsername" placeholder="Elija un nombre de usuario" required>
                    </div>
                    <div class="form-group">
                        <label>Contrase√±a</label>
                        <input type="password" id="registerPassword" placeholder="Cree una contrase√±a" required>
                    </div>
                    <button type="submit" class="btn">Registrarse</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============================================
         P√ÅGINA DEL SISTEMA (DASHBOARD)
    ============================================ -->
    <div id="systemPage">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">Biblioteca N¬∞35</div>
                <div class="sidebar-user">
                    <div class="sidebar-user-name" id="sidebarUserName">Usuario</div>
                    <div class="sidebar-user-role" id="sidebarUserRole">Rol</div>
                </div>
            </div>

            <nav class="sidebar-nav" id="sidebarNav">
                <!-- Se genera din√°micamente seg√∫n el rol -->
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <div id="sectionsContainer">
                <!-- Las secciones se generar√°n din√°micamente -->
            </div>
        </div>
    </div>

    <!-- ============================================
         MODALES
    ============================================ -->

    <!-- MODAL PARA AGREGAR/EDITAR LIBRO -->
    <div id="modalLibro" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalLibroTitle">Agregar Libro</h2>
                <button class="btn-close" onclick="closeModal('modalLibro')">&times;</button>
            </div>
            <form id="formLibro" onsubmit="handleLibroSubmit(event)">
                <div class="form-group">
                    <label>ISBN</label>
                    <input type="text" id="libroISBN" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>T√≠tulo</label>
                        <input type="text" id="libroTitulo" required>
                    </div>
                    <div class="form-group">
                        <label>Autor</label>
                        <input type="text" id="libroAutor" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>G√©nero</label>
                        <input type="text" id="libroGenero" required>
                    </div>
                    <div class="form-group">
                        <label>Formato</label>
                        <select id="libroFormato" required>
                            <option value="F√≠sico">F√≠sico</option>
                            <option value="Digital">Digital</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Cantidad Total</label>
                    <input type="number" id="libroCantidad" min="1" required>
                </div>
                <button type="submit" class="btn">Guardar</button>
            </form>
        </div>
    </div>

    <!-- MODAL PARA PR√âSTAMO -->
    <div id="modalPrestamo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Solicitar Pr√©stamo</h2>
                <button class="btn-close" onclick="closeModal('modalPrestamo')">&times;</button>
            </div>
            <form id="formPrestamo" onsubmit="handlePrestamoSubmit(event)">
                <input type="hidden" id="prestamoLibroId">
                <div class="form-group">
                    <label>Libro Seleccionado</label>
                    <input type="text" id="prestamoLibro" readonly>
                </div>
                <div class="form-group">
                    <label>D√≠as de Pr√©stamo</label>
                    <select id="prestamoDias" required>
                        <option value="7">7 d√≠as</option>
                        <option value="14">14 d√≠as</option>
                        <option value="21">21 d√≠as</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fecha de Retiro</label>
                    <input type="date" id="prestamoFechaRetiro" required>
                </div>
                <button type="submit" class="btn">Confirmar Pr√©stamo</button>
            </form>
        </div>
    </div>

    <!-- MODAL PARA AGREGAR MATERIAL DID√ÅCTICO -->
    <div id="modalMaterial" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Agregar Material Did√°ctico</h2>
                <button class="btn-close" onclick="closeModal('modalMaterial')">&times;</button>
            </div>
            <form id="formMaterial" onsubmit="handleMaterialSubmit(event)">
                <div class="form-group">
                    <label>T√≠tulo del Material</label>
                    <input type="text" id="materialTitulo" required>
                </div>
                <div class="form-group">
                    <label>Materia</label>
                    <input type="text" id="materialMateria" required>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="materialDescripcion" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Archivo PDF</label>
                    <input type="file" accept=".pdf" id="materialArchivo" required>
                </div>
                <button type="submit" class="btn">Subir Material</button>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let currentUser = null;
        let libros = [];
        let prestamos = [];
        let materiales = [];
        let editandoLibro = null;

        // ============================================
        // FUNCIONES DE LOGIN/REGISTRO
        // ============================================
        function switchFormTab(tab) {
            document.querySelectorAll('.form-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.form-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.form-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        function toggleCursoField() {
            const userType = document.getElementById('registerUserType').value;
            const cursoGroup = document.getElementById('cursoGroup');
            const cursoInput = document.getElementById('registerCurso');
            
            if (userType === 'estudiante') {
                cursoGroup.style.display = 'block';
                cursoInput.required = true;
            } else {
                cursoGroup.style.display = 'none';
                cursoInput.required = false;
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const tipo = document.getElementById('loginUserType').value;
            const usuario = document.getElementById('loginUsername').value;
            
            // Simulaci√≥n de login (aqu√≠ se conectar√° con el backend)
            currentUser = {
                nombre: usuario,
                tipo: tipo
            };
            
            showSystem();
        }

        function handleRegister(event) {
            event.preventDefault();
            
            alert('Usuario registrado exitosamente. Ahora puedes iniciar sesi√≥n.');
            switchFormTab('login');
            document.getElementById('registerForm').querySelector('form').reset();
        }

        function showSystem() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('systemPage').classList.add('active');
            
            document.getElementById('sidebarUserName').textContent = currentUser.nombre;
            document.getElementById('sidebarUserRole').textContent = 
                currentUser.tipo.charAt(0).toUpperCase() + currentUser.tipo.slice(1);
            
            initializeData();
            generateNavigation();
            generateSections();
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
                currentUser = null;
                document.getElementById('loginPage').classList.remove('hidden');
                document.getElementById('systemPage').classList.remove('active');
                document.getElementById('loginForm').querySelector('form').reset();
            }
        }

        // ============================================
        // GENERACI√ìN DE NAVEGACI√ìN DIN√ÅMICA
        // ============================================
        function generateNavigation() {
            const nav = document.getElementById('sidebarNav');
            nav.innerHTML = '';
            
            let navItems = [];
            
            if (currentUser.tipo === 'bibliotecaria') {
                navItems = [
                    { id: 'inicio', icon: 'üè†', label: 'Inicio' },
                    { id: 'catalogo', icon: 'üìö', label: 'Cat√°logo de Libros' },
                    { id: 'prestamos', icon: 'üìã', label: 'Pr√©stamos Activos' },
                    { id: 'usuarios', icon: 'üë•', label: 'Usuarios' },
                    { id: 'reportes', icon: 'üìä', label: 'Reportes' }
                ];
            } else if (currentUser.tipo === 'profesor') {
                navItems = [
                    { id: 'inicio', icon: 'üè†', label: 'Inicio' },
                    { id: 'biblioteca', icon: 'üìö', label: 'Biblioteca' },
                    { id: 'misPrestamos', icon: 'üìñ', label: 'Mis Pr√©stamos' },
                    { id: 'materiales', icon: 'üìÑ', label: 'Mis Materiales' }
                ];
            } else {
                navItems = [
                    { id: 'inicio', icon: 'üè†', label: 'Inicio' },
                    { id: 'biblioteca', icon: 'üìö', label: 'Biblioteca' },
                    { id: 'misPrestamos', icon: 'üìñ', label: 'Mis Pr√©stamos' },
                    { id: 'materialesProfesor', icon: 'üì•', label: 'Material Did√°ctico' }
                ];
            }
            
            navItems.forEach((item, index) => {
                const navItem = document.createElement('div');
                navItem.className = 'nav-item' + (index === 0 ? ' active' : '');
                navItem.innerHTML = `<span class="nav-icon">${item.icon}</span><span>${item.label}</span>`;
                navItem.onclick = () => navigateToSection(item.id);
                nav.appendChild(navItem);
            });
        }

        function navigateToSection(sectionId) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            event.target.closest('.nav-item').classList.add('active');
            document.getElementById('section-' + sectionId).classList.add('active');
        }

        // ============================================
        // GENERACI√ìN DE SECCIONES DIN√ÅMICAS
        // ============================================
        function generateSections() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = '';
            
            if (currentUser.tipo === 'bibliotecaria') {
                container.innerHTML = `
                    ${getInicioSection()}
                    ${getCatalogoSection()}
                    ${getPrestamosSection()}
                    ${getUsuariosSection()}
                    ${getReportesSection()}
                `;
            } else if (currentUser.tipo === 'profesor') {
                container.innerHTML = `
                    ${getInicioSection()}
                    ${getBibliotecaSection()}
                    ${getMisPrestamosSection()}
                    ${getMisMaterialesSection()}
                `;
            } else {
                container.innerHTML = `
                    ${getInicioSection()}
                    ${getBibliotecaSection()}
                    ${getMisPrestamosSection()}
                    ${getMaterialesProfesorSection()}
                `;
            }
            
            renderAllSections();
        }

        function getInicioSection() {
            return `
                <div id="section-inicio" class="section active">
                    <div class="page-header">
                        <h1 class="page-title">Bienvenido, ${currentUser.nombre}</h1>
                        <p class="page-subtitle">Sistema de Gesti√≥n Bibliotecaria</p>
                    </div>
                    <div class="stats-grid" id="statsInicio"></div>
                </div>
            `;
        }

        function getCatalogoSection() {
            return `
                <div id="section-catalogo" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Cat√°logo de Libros</h1>
                        <p class="page-subtitle">Gesti√≥n completa de libros de la biblioteca</p>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Libros Registrados</h2>
                            <button class="btn-add" onclick="openModalLibro()">
                                <span>+</span> Agregar Libro
                            </button>
                        </div>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="Buscar por t√≠tulo, autor o ISBN..." oninput="searchLibros(event)">
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ISBN</th>
                                    <th>T√≠tulo</th>
                                    <th>Autor</th>
                                    <th>G√©nero</th>
                                    <th>Disponibles</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaCatalogo"></tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getBibliotecaSection() {
            return `
                <div id="section-biblioteca" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Biblioteca</h1>
                        <p class="page-subtitle">Explora y solicita pr√©stamos de libros disponibles</p>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Libros Disponibles</h2>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="Buscar libros..." oninput="searchBiblioteca(event)">
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>T√≠tulo</th>
                                    <th>Autor</th>
                                    <th>G√©nero</th>
                                    <th>Disponibles</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaBiblioteca"></tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getMisPrestamosSection() {
            return `
                <div id="section-misPrestamos" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Mis Pr√©stamos</h1>
                        <p class="page-subtitle">Administra tus pr√©stamos activos</p>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Pr√©stamos Activos</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>N¬∞ Operaci√≥n</th>
                                    <th>Libro</th>
                                    <th>Fecha Retiro</th>
                                    <th>Fecha Devoluci√≥n</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaMisPrestamos"></tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getPrestamosSection() {
            return `
                <div id="section-prestamos" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Pr√©stamos Activos</h1>
                        <p class="page-subtitle">Gesti√≥n de todos los pr√©stamos de la biblioteca</p>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Todos los Pr√©stamos</h2>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="Buscar por usuario o libro..." oninput="searchPrestamos(event)">
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>N¬∞ Operaci√≥n</th>
                                    <th>Usuario</th>
                                    <th>Libro</th>
                                    <th>Fecha Retiro</th>
                                    <th>Fecha Devoluci√≥n</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaPrestamos"></tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getUsuariosSection() {
            return `
                <div id="section-usuarios" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Usuarios</h1>
                        <p class="page-subtitle">Gesti√≥n de usuarios del sistema</p>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Lista de Usuarios</h2>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="Buscar usuarios..." oninput="searchUsuarios(event)">
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>DNI</th>
                                    <th>Tipo</th>
                                    <th>Curso</th>
                                    <th>Pr√©stamos Activos</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="tablaUsuarios"></tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getMisMaterialesSection() {
            return `
                <div id="section-materiales" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Mis Materiales Did√°cticos</h1>
                        <p class="page-subtitle">Gestiona el material de tus materias</p>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Materiales Publicados</h2>
                            <button class="btn-add" onclick="openModal('modalMaterial')">
                                <span>+</span> Agregar Material
                            </button>
                        </div>
                        <div class="resources-grid" id="gridMisMateriales"></div>
                    </div>
                </div>
            `;
        }

        function getMaterialesProfesorSection() {
            return `
                <div id="section-materialesProfesor" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Material Did√°ctico</h1>
                        <p class="page-subtitle">Descarga material de tus profesores</p>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Materiales Disponibles</h2>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="Buscar por materia o profesor..." oninput="searchMaterialesProf(event)">
                        </div>
                        <div class="resources-grid" id="gridMaterialesProf"></div>
                    </div>
                </div>
            `;
        }

        function getReportesSection() {
            return `
                <div id="section-reportes" class="section">
                    <div class="page-header">
                        <h1 class="page-title">Reportes y Estad√≠sticas</h1>
                        <p class="page-subtitle">An√°lisis de la actividad bibliotecaria</p>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="statTotalLibros">0</div>
                            <div class="stat-label">Total Libros</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statLibrosDisponibles">0</div>
                            <div class="stat-label">Libros Disponibles</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statPrestamosActivos">0</div>
                            <div class="stat-label">Pr√©stamos Activos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statPrestamosVencidos">0</div>
                            <div class="stat-label">Pr√©stamos Vencidos</div>
                        </div>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Libros M√°s Prestados</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Posici√≥n</th>
                                    <th>Libro</th>
                                    <th>Autor</th>
                                    <th>Cantidad de Pr√©stamos</th>
                                </tr>
                            </thead>
                            <tbody id="tablaTopLibros"></tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Usuarios con Pr√©stamos Vencidos</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Usuario</th>
                                    <th>Libro</th>
                                    <th>D√≠as de Retraso</th>
                                    <th>Fecha Devoluci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="tablaVencidos"></tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============================================
        // INICIALIZACI√ìN DE DATOS
        // ============================================
        function initializeData() {
            libros = [
                { id: 1, isbn: '978-3-16-148410-0', titulo: 'Cien A√±os de Soledad', autor: 'Gabriel Garc√≠a M√°rquez', genero: 'Ficci√≥n', formato: 'F√≠sico', cantidadTotal: 5, disponibles: 3 },
                { id: 2, isbn: '978-0-452-28423-4', titulo: '1984', autor: 'George Orwell', genero: 'Distop√≠a', formato: 'F√≠sico', cantidadTotal: 4, disponibles: 2 },
                { id: 3, isbn: '978-0-06-112008-4', titulo: 'Matar a un Ruise√±or', autor: 'Harper Lee', genero: 'Drama', formato: 'F√≠sico', cantidadTotal: 3, disponibles: 3 },
                { id: 4, isbn: '978-0-7432-7356-5', titulo: 'El C√≥digo Da Vinci', autor: 'Dan Brown', genero: 'Suspenso', formato: 'F√≠sico', cantidadTotal: 6, disponibles: 4 }
            ];

            prestamos = [
                { id: 1, numeroOperacion: 'OP-2024-001', usuario: 'Juan P√©rez', libro: 'Cien A√±os de Soledad', fechaRetiro: '2024-11-01', fechaDevolucion: '2024-11-15', estado: 'Activo' },
                { id: 2, numeroOperacion: 'OP-2024-002', usuario: 'Mar√≠a Gonz√°lez', libro: '1984', fechaRetiro: '2024-10-25', fechaDevolucion: '2024-11-08', estado: 'Vencido' }
            ];

            materiales = [
                { id: 1, titulo: 'Gu√≠a de Matem√°tica - Funciones', materia: 'Matem√°tica', profesor: 'Prof. Roberto D√≠az', descripcion: 'Material completo sobre funciones lineales y cuadr√°ticas con ejercicios resueltos.', fecha: '2024-10-15' },
                { id: 2, titulo: 'Apuntes de Historia Argentina', materia: 'Historia', profesor: 'Prof. Ana Mart√≠nez', descripcion: 'Resumen detallado del per√≠odo 1810-1880 con mapas conceptuales.', fecha: '2024-10-20' },
                { id: 3, titulo: 'Laboratorio de F√≠sica - Mec√°nica', materia: 'F√≠sica', profesor: 'Prof. Carlos L√≥pez', descripcion: 'Gu√≠a de experimentos de mec√°nica cl√°sica y an√°lisis de resultados.', fecha: '2024-10-28' }
            ];
        }

        // ============================================
        // RENDERIZADO DE SECCIONES
        // ============================================
        function renderAllSections() {
            renderInicio();
            if (currentUser.tipo === 'bibliotecaria') {
                renderCatalogo();
                renderAllPrestamos();
                renderUsuarios();
                renderReportes();
            } else if (currentUser.tipo === 'profesor') {
                renderBiblioteca();
                renderMisPrestamos();
                renderMisMateriales();
            } else {
                renderBiblioteca();
                renderMisPrestamos();
                renderMaterialesProfesor();
            }
        }

        function renderInicio() {
            const statsContainer = document.getElementById('statsInicio');
            if (!statsContainer) return;

            let stats = [];
            if (currentUser.tipo === 'bibliotecaria') {
                stats = [
                    { number: libros.length, label: 'Libros en Cat√°logo' },
                    { number: libros.reduce((sum, l) => sum + l.disponibles, 0), label: 'Libros Disponibles' },
                    { number: prestamos.length, label: 'Pr√©stamos Activos' },
                    { number: 3, label: 'Usuarios Registrados' }
                ];
            } else if (currentUser.tipo === 'profesor') {
                stats = [
                    { number: libros.filter(l => l.disponibles > 0).length, label: 'Libros Disponibles' },
                    { number: prestamos.filter(p => p.usuario === currentUser.nombre).length, label: 'Mis Pr√©stamos' },
                    { number: materiales.filter(m => m.profesor.includes(currentUser.nombre)).length, label: 'Mis Materiales' },
                    { number: materiales.length, label: 'Total Materiales' }
                ];
            } else {
                stats = [
                    { number: libros.filter(l => l.disponibles > 0).length, label: 'Libros Disponibles' },
                    { number: prestamos.filter(p => p.usuario === currentUser.nombre).length, label: 'Mis Pr√©stamos' },
                    { number: materiales.length, label: 'Materiales Disponibles' },
                    { number: 0, label: 'Reservas Pendientes' }
                ];
            }

            statsContainer.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-number">${stat.number}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        function renderCatalogo() {
            const tbody = document.getElementById('tablaCatalogo');
            if (!tbody) return;
            
            tbody.innerHTML = libros.map(libro => `
                <tr>
                    <td>${libro.isbn}</td>
                    <td><strong>${libro.titulo}</strong></td>
                    <td>${libro.autor}</td>
                    <td>${libro.genero}</td>
                    <td>${libro.disponibles}/${libro.cantidadTotal}</td>
                    <td><span class="badge ${libro.disponibles > 0 ? 'badge-available' : 'badge-borrowed'}">${libro.disponibles > 0 ? 'Disponible' : 'Agotado'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-edit" onclick="editarLibro(${libro.id})">‚úèÔ∏è Editar</button>
                            <button class="btn-action btn-delete" onclick="eliminarLibro(${libro.id})">üóëÔ∏è Eliminar</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderBiblioteca() {
            const tbody = document.getElementById('tablaBiblioteca');
            if (!tbody) return;
            
            tbody.innerHTML = libros.filter(libro => libro.disponibles > 0).map(libro => `
                <tr>
                    <td><strong>${libro.titulo}</strong></td>
                    <td>${libro.autor}</td>
                    <td>${libro.genero}</td>
                    <td>${libro.disponibles}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-borrow" onclick="solicitarPrestamo(${libro.id})">üìñ Pedir Pr√©stamo</button>
                            <button class="btn-action btn-reserve">üîñ Reservar</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderMisPrestamos() {
            const tbody = document.getElementById('tablaMisPrestamos');
            if (!tbody) return;
            
            const misPrestamos = prestamos.filter(p => p.usuario === currentUser.nombre);
            
            if (misPrestamos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; color: #718096;">No tienes pr√©stamos activos</td></tr>';
                return;
            }
            
            tbody.innerHTML = misPrestamos.map(prestamo => `
                <tr>
                    <td><strong>${prestamo.numeroOperacion}</strong></td>
                    <td>${prestamo.libro}</td>
                    <td>${prestamo.fechaRetiro}</td>
                    <td>${prestamo.fechaDevolucion}</td>
                    <td><span class="badge ${prestamo.estado === 'Activo' ? 'badge-available' : 'badge-borrowed'}">${prestamo.estado}</span></td>
                    <td>
                        <button class="btn-action btn-download" onclick="descargarComprobante('${prestamo.numeroOperacion}')">üìÑ Descargar PDF</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderAllPrestamos() {
            const tbody = document.getElementById('tablaPrestamos');
            if (!tbody) return;
            
            tbody.innerHTML = prestamos.map(prestamo => `
                <tr>
                    <td><strong>${prestamo.numeroOperacion}</strong></td>
                    <td>${prestamo.usuario}</td>
                    <td>${prestamo.libro}</td>
                    <td>${prestamo.fechaRetiro}</td>
                    <td>${prestamo.fechaDevolucion}</td>
                    <td><span class="badge ${prestamo.estado === 'Activo' ? 'badge-available' : 'badge-borrowed'}">${prestamo.estado}</span></td>
                    <td>
                        <button class="btn-action btn-edit" onclick="marcarDevuelto(${prestamo.id})">‚úÖ Marcar Devuelto</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderUsuarios() {
            const tbody = document.getElementById('tablaUsuarios');
            if (!tbody) return;
            
            const usuarios = [
                { nombre: 'Juan P√©rez', dni: '12345678', tipo: 'Estudiante', curso: '5¬∞ A', prestamos: 1 },
                { nombre: 'Mar√≠a Gonz√°lez', dni: '87654321', tipo: 'Estudiante', curso: '4¬∞ B', prestamos: 1 },
                { nombre: 'Roberto D√≠az', dni: '11223344', tipo: 'Profesor', curso: '-', prestamos: 0 }
            ];
            
            tbody.innerHTML = usuarios.map(usuario => `
                <tr>
                    <td><strong>${usuario.nombre}</strong></td>
                    <td>${usuario.dni}</td>
                    <td>${usuario.tipo}</td>
                    <td>${usuario.curso}</td>
                    <td>${usuario.prestamos}</td>
                    <td><span class="badge badge-available">Activo</span></td>
                </tr>
            `).join('');
        }

        function renderMisMateriales() {
            const grid = document.getElementById('gridMisMateriales');
            if (!grid) return;
            
            const misMateriales = materiales.filter(m => m.profesor.includes(currentUser.nombre));
            
            if (misMateriales.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #718096;">No has publicado materiales a√∫n</p>';
                return;
            }
            
            grid.innerHTML = misMateriales.map(material => `
                <div class="resource-card">
                    <div class="resource-title">${material.titulo}</div>
                    <div class="resource-meta">
                        üìö ${material.materia}<br>
                        üìÖ ${material.fecha}
                    </div>
                    <p class="resource-description">${material.descripcion}</p>
                    <div class="action-buttons">
                        <button class="btn-action btn-edit" onclick="editarMaterial(${material.id})">‚úèÔ∏è Editar</button>
                        <button class="btn-action btn-delete" onclick="eliminarMaterial(${material.id})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function renderMaterialesProfesor() {
            const grid = document.getElementById('gridMaterialesProf');
            if (!grid) return;
            
            grid.innerHTML = materiales.map(material => `
                <div class="resource-card">
                    <div class="resource-title">${material.titulo}</div>
                    <div class="resource-meta">
                        üë®‚Äçüè´ ${material.profesor}<br>
                        üìö ${material.materia}<br>
                        üìÖ ${material.fecha}
                    </div>
                    <p class="resource-description">${material.descripcion}</p>
                    <button class="btn btn-download" style="width: 100%;" onclick="descargarMaterial(${material.id})">üì• Descargar PDF</button>
                </div>
            `).join('');
        }

        function renderReportes() {
            document.getElementById('statTotalLibros').textContent = libros.reduce((sum, libro) => sum + libro.cantidadTotal, 0);
            document.getElementById('statLibrosDisponibles').textContent = libros.reduce((sum, libro) => sum + libro.disponibles, 0);
            document.getElementById('statPrestamosActivos').textContent = prestamos.filter(p => p.estado === 'Activo').length;
            document.getElementById('statPrestamosVencidos').textContent = prestamos.filter(p => p.estado === 'Vencido').length;

            const topLibros = [
                { posicion: 1, libro: 'Cien A√±os de Soledad', autor: 'Gabriel Garc√≠a M√°rquez', cantidad: 15 },
                { posicion: 2, libro: '1984', autor: 'George Orwell', cantidad: 12 },
                { posicion: 3, libro: 'Matar a un Ruise√±or', autor: 'Harper Lee', cantidad: 8 }
            ];

            document.getElementById('tablaTopLibros').innerHTML = topLibros.map(libro => `
                <tr>
                    <td><strong>#${libro.posicion}</strong></td>
                    <td>${libro.libro}</td>
                    <td>${libro.autor}</td>
                    <td>${libro.cantidad}</td>
                </tr>
            `).join('');

            const vencidos = prestamos.filter(p => p.estado === 'Vencido');
            document.getElementById('tablaVencidos').innerHTML = vencidos.map(prestamo => `
                <tr>
                    <td>${prestamo.usuario}</td>
                    <td>${prestamo.libro}</td>
                    <td style="color: #c53030; font-weight: bold;">3 d√≠as</td>
                    <td>${prestamo.fechaDevolucion}</td>
                </tr>
            `).join('');
        }

        // ============================================
        // FUNCIONES DE MODALES
        // ============================================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openModalLibro(libroId = null) {
            if (libroId) {
                const libro = libros.find(l => l.id === libroId);
                document.getElementById('modalLibroTitle').textContent = 'Editar Libro';
                document.getElementById('libroISBN').value = libro.isbn;
                document.getElementById('libroTitulo').value = libro.titulo;
                document.getElementById('libroAutor').value = libro.autor;
                document.getElementById('libroGenero').value = libro.genero;
                document.getElementById('libroFormato').value = libro.formato;
                document.getElementById('libroCantidad').value = libro.cantidadTotal;
                editandoLibro = libroId;
            } else {
                document.getElementById('modalLibroTitle').textContent = 'Agregar Libro';
                document.getElementById('formLibro').reset();
                editandoLibro = null;
            }
            openModal('modalLibro');
        }

        // ============================================
        // FUNCIONES DE LIBROS
        // ============================================
        function handleLibroSubmit(event) {
            event.preventDefault();
            
            const libroData = {
                isbn: document.getElementById('libroISBN').value,
                titulo: document.getElementById('libroTitulo').value,
                autor: document.getElementById('libroAutor').value,
                genero: document.getElementById('libroGenero').value,
                formato: document.getElementById('libroFormato').value,
                cantidadTotal: parseInt(document.getElementById('libroCantidad').value)
            };
            
            if (editandoLibro) {
                const libro = libros.find(l => l.id === editandoLibro);
                const diferencia = libroData.cantidadTotal - libro.cantidadTotal;
                Object.assign(libro, libroData);
                libro.disponibles += diferencia;
                alert('Libro actualizado exitosamente');
            } else {
                const nuevoLibro = {
                    id: libros.length > 0 ? Math.max(...libros.map(l => l.id)) + 1 : 1,
                    ...libroData,
                    disponibles: libroData.cantidadTotal
                };
                libros.push(nuevoLibro);
                alert('Libro agregado exitosamente');
            }
            
            renderCatalogo();
            renderInicio();
            closeModal('modalLibro');
            document.getElementById('formLibro').reset();
        }

        function editarLibro(id) {
            openModalLibro(id);
        }

        function eliminarLibro(id) {
            if (confirm('¬øEst√° seguro de eliminar este libro del cat√°logo?')) {
                libros = libros.filter(libro => libro.id !== id);
                renderCatalogo();
                renderInicio();
                alert('Libro eliminado exitosamente');
            }
        }

        // ============================================
        // FUNCIONES DE PR√âSTAMOS
        // ============================================
        function solicitarPrestamo(libroId) {
            const libro = libros.find(l => l.id === libroId);
            document.getElementById('prestamoLibroId').value = libro.id;
            document.getElementById('prestamoLibro').value = libro.titulo;
            
            // Establecer fecha m√≠nima como hoy
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('prestamoFechaRetiro').min = hoy;
            document.getElementById('prestamoFechaRetiro').value = hoy;
            
            openModal('modalPrestamo');
        }

        function handlePrestamoSubmit(event) {
            event.preventDefault();
            
            const libroId = parseInt(document.getElementById('prestamoLibroId').value);
            const libro = libros.find(l => l.id === libroId);
            const dias = parseInt(document.getElementById('prestamoDias').value);
            const fechaRetiro = new Date(document.getElementById('prestamoFechaRetiro').value);
            const fechaDevolucion = new Date(fechaRetiro);
            fechaDevolucion.setDate(fechaDevolucion.getDate() + dias);
            
            const nuevoPrestamo = {
                id: prestamos.length > 0 ? Math.max(...prestamos.map(p => p.id)) + 1 : 1,
                numeroOperacion: `OP-2024-${String(prestamos.length + 3).padStart(3, '0')}`,
                usuario: currentUser.nombre,
                libro: libro.titulo,
                fechaRetiro: fechaRetiro.toISOString().split('T')[0],
                fechaDevolucion: fechaDevolucion.toISOString().split('T')[0],
                estado: 'Activo'
            };
            
            prestamos.push(nuevoPrestamo);
            libro.disponibles--;
            
            // Generar y descargar comprobante PDF
            generarPDFComprobante(nuevoPrestamo);
            
            alert('Pr√©stamo registrado exitosamente. Descargando comprobante...');
            
            closeModal('modalPrestamo');
            document.getElementById('formPrestamo').reset();
            renderMisPrestamos();
            renderBiblioteca();
            renderInicio();
        }

        function generarPDFComprobante(prestamo) {
            const texto = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    COMPROBANTE DE PR√âSTAMO - BIBLIOSYSTEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

N√∫mero de Operaci√≥n: ${prestamo.numeroOperacion}
Usuario: ${prestamo.usuario}
Libro: ${prestamo.libro}

Fecha de Retiro: ${prestamo.fechaRetiro}
Fecha de Devoluci√≥n: ${prestamo.fechaDevolucion}

Estado: ${prestamo.estado}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Por favor, presentar este comprobante al
momento de retirar el libro.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            `;
            
            console.log('PDF Generado:', texto);
            alert('COMPROBANTE DE PR√âSTAMO\n\n' + texto + '\n\nEn producci√≥n, esto descargar√° un PDF real.');
        }

        function descargarComprobante(numeroOperacion) {
            const prestamo = prestamos.find(p => p.numeroOperacion === numeroOperacion);
            if (prestamo) {
                generarPDFComprobante(prestamo);
            }
        }

        function marcarDevuelto(id) {
            const prestamo = prestamos.find(p => p.id === id);
            if (prestamo && confirm(`¬øMarcar como devuelto el pr√©stamo ${prestamo.numeroOperacion}?`)) {
                const libro = libros.find(l => l.titulo === prestamo.libro);
                if (libro) {
                    libro.disponibles++;
                }
                prestamos = prestamos.filter(p => p.id !== id);
                renderAllPrestamos();
                renderCatalogo();
                renderInicio();
                alert('Pr√©stamo marcado como devuelto exitosamente');
            }
        }

        // ============================================
        // FUNCIONES DE MATERIALES
        // ============================================
        function handleMaterialSubmit(event) {
            event.preventDefault();
            
            const archivo = document.getElementById('materialArchivo').files[0];
            if (!archivo) {
                alert('Por favor, seleccione un archivo PDF');
                return;
            }
            
            const nuevoMaterial = {
                id: materiales.length > 0 ? Math.max(...materiales.map(m => m.id)) + 1 : 1,
                titulo: document.getElementById('materialTitulo').value,
                materia: document.getElementById('materialMateria').value,
                descripcion: document.getElementById('materialDescripcion').value,
                profesor: currentUser.nombre,
                fecha: new Date().toISOString().split('T')[0],
                archivo: archivo.name
            };
            
            materiales.push(nuevoMaterial);
            
            alert('Material agregado exitosamente');
            
            closeModal('modalMaterial');
            document.getElementById('formMaterial').reset();
            renderMisMateriales();
            renderInicio();
        }

        function editarMaterial(id) {
            alert('Funci√≥n de editar material - ID: ' + id + '\n\nEsta funcionalidad se implementar√° con el backend.');
        }

        function eliminarMaterial(id) {
            if (confirm('¬øEst√° seguro de eliminar este material?')) {
                materiales = materiales.filter(m => m.id !== id);
                renderMisMateriales();
                renderInicio();
                alert('Material eliminado exitosamente');
            }
        }

        function descargarMaterial(id) {
            const material = materiales.find(m => m.id === id);
            if (material) {
                alert(`Descargando: ${material.titulo}\nMateria: ${material.materia}\nProfesor: ${material.profesor}\n\nEn producci√≥n, esto descargar√° el PDF real del material.`);
            }
        }

        // ============================================
        // FUNCIONES DE B√öSQUEDA
        // ============================================
        function searchLibros(event) {
            const query = event.target.value.toLowerCase();
            const tbody = document.getElementById('tablaCatalogo');
            const rows = tbody.getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function searchBiblioteca(event) {
            const query = event.target.value.toLowerCase();
            const tbody = document.getElementById('tablaBiblioteca');
            const rows = tbody.getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function searchPrestamos(event) {
            const query = event.target.value.toLowerCase();
            const tbody = document.getElementById('tablaPrestamos');
            const rows = tbody.getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function searchUsuarios(event) {
            const query = event.target.value.toLowerCase();
            const tbody = document.getElementById('tablaUsuarios');
            const rows = tbody.getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        function searchMaterialesProf(event) {
            const query = event.target.value.toLowerCase();
            const grid = document.getElementById('gridMaterialesProf');
            const cards = grid.getElementsByClassName('resource-card');
            
            Array.from(cards).forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        
        // Establecer fecha m√≠nima en el campo de fecha
        document.addEventListener('DOMContentLoaded', function() {
            const hoy = new Date().toISOString().split('T')[0];
            const fechaInput = document.getElementById('prestamoFechaRetiro');
            if (fechaInput) {
                fechaInput.min = hoy;
            }
        });

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>